/*
 * vcnl4010.h
 *
 *  Created on: 10.01.2019
 *      Author: bartek
 */

#ifndef VCNL4010_H_
#define VCNL4010_H_

#include "stdbool.h"
#include "main.h"

/* Distance sensors */
#define VCNL4010_FRONT_ENABLE			HAL_GPIO_WritePin(DIST3_EN_GPIO_Port, DIST3_EN_Pin, GPIO_PIN_RESET)
#define VCNL4010_RIGHT_ENABLE 			HAL_GPIO_WritePin(DIST1_EN_GPIO_Port, DIST1_EN_Pin, GPIO_PIN_RESET)
#define VCNL4010_LEFT_ENABLE			HAL_GPIO_WritePin(DIST5_EN_GPIO_Port, DIST5_EN_Pin, GPIO_PIN_RESET)
#define VCNL4010_FRONT_RIGHT_ENABLE		HAL_GPIO_WritePin(DIST2_EN_GPIO_Port, DIST2_EN_Pin, GPIO_PIN_RESET)
#define VCNL4010_FRONT_LEFT_ENABLE		HAL_GPIO_WritePin(DIST4_EN_GPIO_Port, DIST4_EN_Pin, GPIO_PIN_RESET)
#define VCNL4010_FRONT_DISABLE			HAL_GPIO_WritePin(DIST3_EN_GPIO_Port, DIST3_EN_Pin, GPIO_PIN_SET)
#define VCNL4010_RIGHT_DISABLE			HAL_GPIO_WritePin(DIST1_EN_GPIO_Port, DIST1_EN_Pin, GPIO_PIN_SET)
#define VCNL4010_LEFT_DISABLE			HAL_GPIO_WritePin(DIST5_EN_GPIO_Port, DIST5_EN_Pin, GPIO_PIN_SET)
#define VCNL4010_FRONT_RIGHT_DISABLE	HAL_GPIO_WritePin(DIST2_EN_GPIO_Port, DIST2_EN_Pin, GPIO_PIN_SET)
#define VCNL4010_FRONT_LEFT_DISABLE		HAL_GPIO_WritePin(DIST4_EN_GPIO_Port, DIST4_EN_Pin, GPIO_PIN_SET)

#define VCNL4010_I2CADDR_DEFAULT 		(0x13U << 1U)

// commands and constants
#define VCNL4010_REG_COMMAND 			0x80
#define VCNL4010_REG_PRODUCTID 			0x81
#define VCNL4010_REG_PROXRATE 			0x82
#define VCNL4010_REG_IRLED				0x83
#define VCNL4010_REG_AMBIENTPARAMETER 	0x84
#define VCNL4010_REG_AMBIENTDATA_H 		0x85
#define VCNL4010_REG_AMBIENTDATA_L 		0x86
#define VCNL4010_REG_PROXIMITYDATA_H	0x87
#define VCNL4010_REG_PROXIMITYDATA_L	0x88
#define VCNL4010_REG_INTCONTROL 		0x89
#define VCNL4010_REG_PROXINITYADJUST	0x8A
#define VCNL4010_REG_INTSTAT 			0x8E
#define VCNL4010_REG_MODTIMING 			0x8F

typedef enum
{
	VCNL4010_1_95 = 0,
	VCNL4010_3_90625 = 1,
	VCNL4010_7_8125 = 2,
	VCNL4010_16_625 = 3,
	VCNL4010_31_25 = 4,
	VCNL4010_62_5 = 5,
	VCNL4010_125 = 6,
	VCNL4010_250 = 7,
} vcnl4010_freq;

#define VCNL4010_COMMAND_MEASUREAMBIENT 	0x10
#define VCNL4010_COMMAND_MEASUREPROXIMITY 	0x08
#define VCNL4010_COMMAND_AMBIENTREADY		0x40
#define VCNL4010_COMMAND_PROXIMITYREADY 	0x20
#define VCNL4010_ANSWER_ID_REVISION 		0x21



bool InitVCNL4010();
bool VCNL4010_begin();
uint8_t VCNL4010_getLEDcurrent(void);
void VCNL4010_setLEDcurrent(uint8_t c);
void VCNL4010_setFrequency(vcnl4010_freq f);
uint16_t VCNL4010_readProximity(void);
uint16_t VCNL4010_readAmbient(void);
void VCNL4010_Controller();

static inline void VCNL4010_disableAll()
{
	VCNL4010_FRONT_DISABLE;
	VCNL4010_RIGHT_DISABLE;
	VCNL4010_LEFT_DISABLE;
	VCNL4010_FRONT_RIGHT_DISABLE;
	VCNL4010_FRONT_LEFT_DISABLE;
}

#endif /* VCNL4010_H_ */
